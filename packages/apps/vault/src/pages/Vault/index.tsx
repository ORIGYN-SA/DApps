import React, { useContext, useEffect, useState } from 'react';
import { Link } from 'react-router-dom';
import { useSnackbar } from 'notistack';
import { AuthContext, useRoute } from '@dapp/features-authentication';
import { useVault } from '../../components/context';
import { useDialog } from '@connect2ic/react';
import { TokenIcon, LoadingContainer, WalletTokens } from '@dapp/features-components';
import { useTokensContext } from '@dapp/features-tokens-provider';
import { copyToClipboard, currencyToFixed, parseMetadata, parseOdcs } from '@dapp/utils';
import { PlaceholderImage } from '@dapp/common-assets';
import { getNftCollectionMeta, OrigynClient } from '@origyn-sa/mintjs';
import TransferTokensModal from '@dapp/features-sales-escrows/modals/TransferTokens';
import ManageEscrowsModal from '@dapp/features-sales-escrows/modals/ManageEscrows';
import ManageDepositsModal from '@dapp/features-sales-escrows/modals/ManageDepositsModal';
import Filter from './Filter';
import styled from 'styled-components';
import {
  Button,
  Card,
  Flex,
  Grid,
  HR,
  Icons,
  SecondaryNav,
  Container,
  ShowMoreBlock,
} from '@origyn-sa/origyn-art-ui';
import { Principal } from '@dfinity/principal';

const GuestContainer = () => {
  const { open } = useDialog();

  return (
    <div
      style={{
        alignItems: 'center',
        display: 'flex',
        flexGrow: 1,
        minHeight: '100%',
      }}
    >
      <Container maxWidth="md">
        <div
          style={{
            alignItems: 'center',
            display: 'flex',
            flexDirection: 'column',
          }}
        >
          <h3>Welcome to the Origyn Vault</h3>
          <br />
          <Button variant="contained" onClick={open}>
            Connect wallet
          </Button>
        </div>
      </Container>
    </div>
  );
};

const SocialMediaButton = styled(Button)`
  background: #242424;
`;

const StyledSectionTitle = styled.h2`
  margin: 48px 24px;
`;

const StyledCustomGrid = styled(Grid)`
  grid-template-columns: minmax(0, 2fr) minmax(0, 5fr);
  padding: 24px;

  ${({ theme }) => theme.media.lg} {
    grid-template-columns: minmax(0, 1fr) minmax(0, 2fr);
  }
`;

const StyledBlackCard = styled(Card)`
  background: ${({ theme }) => theme.colors.DARK_BLACK};
`;

const StyledBlackItemCard = styled(Card)`
  background: ${({ theme }) => theme.colors.DARK_BLACK};
`;

const StyledCollectionImg = styled.img`
  width: 96px;
  height: 96px;
  border-radius: 12px;
`;

const StyledNFTImg = styled.img`
  width: 100%;
  flex-shrink: 0;
  object-fit: cover;
  border-radius: 12px;
  height: calc(10vw - 20px);
  position: relative;

  &.errorImage::after {
    position: absolute;
    content: '';
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAyoAAAMqCAYAAABtybXHAAAAAXNSR0IArs4c6QAAIABJREFUeF7t3f2TFNX1B+DLm6xIQJDgqhsRJbCWpsz//1ckFRNeIiFSiCiwvIiLC8J+6+43JMYAM3OnT/fp6WeqKH/YuadPP+f+kE965s6+O3fu7BYvAgQIECBAgAABAgQIJBLYJ6gkmoZWCBAgQIAAAQIECBDYExBUbAQCBAgQIECAAAECBNIJCCrpRqIhAgQIECBAgAABAgQEFXuAAAECBAgQIECAAIF0AoJKupFoiAABAgQIECBAgAABQcUeIECAAAECBAgQIEAgnYCgkm4kGiJAgAABAgQIECBAQFCxBwgQIECAAAECBAgQSCcgqKQbiYYIECBAgAABAgQIEBBU7AECBAgQIECAAAECBNIJCCrpRqIhAgQIECBAgAABAgQEFXuAAAECBAgQIECAAIF0AoJKupFoiAABAgQIECBAgAABQcUeIECAAAECBAgQIEAgnYCgkm4kGiJAgAABAgQIECBAQFCxBwgQIECAAAECBAgQSCcgqKQbiYYIECBAgAABAgQIEBBU7AECBAgQIECAAAECBNIJCCrpRqIhAgQIECBAgAABAgQEFXuAAAECBAgQIECAAIF0AoJKupFoiAABAgQIECBAgAABQcUeIECAAAECBAgQIEAgnYCgkm4kGiJAgAABAgQIECBAQFCxBwgQIECAAAECBAgQSCcgqKQbiYYIECBAgAABAgQIEBBU7AECBAgQIECAAAECBNIJCCrpRqIhAgQIECBAgAABAgQEFXuAAAECBAgQIECAAIF0AoJKupFoiAABAgQIECBAgAABQcUeIECAAAECBAgQIEAgnYCgkm4kGiJAgAABAgQIECBAQFCxBwgQIECAAAECBAgQSCcgqKQbiYYIECBAgAABAgQIEBBU7AECBAgQIECAAAECBNIJCCrpRqIhAgQIECBAgAABAgQEFXuAAAECBAgQIECAAIF0AoJKupFoiAABAgQIECBAgAABQcUeIECAAAECBAgQIEAgnYCgkm4kGiJAgAABAgQIECBAQFCxBwgQIECAAAECBAgQSCcgqKQbiYYIECBAgAABAgQIEBBU7AECBAgQIECAAAECBNIJCCrpRqIhAgQIECBAgAABAgQEFXuAAAECBAgQIECAAIF0AoJKupFoiAABAgQIECBAgAABQcUeIECAAAECBAgQIEAgnYCgkm4kGiJAgAABAgQIECBAQFCxBwgQIECAAAECBAgQSCcgqKQbiYYIECBAgAABAgQIEBBU7AECBAgQIECAAAECBNIJCCrpRqIhAgQIECBAgAABAgQEFXuAAAECBAgQIECAAIF0AoJKupFoiAABAgQIECBAgAABQcUeIECAAAECBAgQIEAgnYCgkm4kGiJAgAABAgQIECBAQFCxBwgQIECAAAECBAgQSCcgqKQbiYYIECBAgAABAgQIEBBU7AECBAgQIECAAAECBNIJCCrpRqIhAgQIECBAgAABAgQEFXuAAAECBAgQIECAAIF0AoJKupFoiAABAgQIECBAgAABQcUeIECAAAECBAgQIEAgnYCgkm4kGiJAgAABAgQIECBAQFCxBwgQIECAAAECBAgQSCcgqKQbiYYIECBAgAABAgQIEBBU7AECBAgQIECAAAECBNIJCCrpRqIhAgQIECBAgAABAgQEFXuAAAECBAgQIECAAIF0AoJKupFoiAABAgQIECBAgAABQcUeIECAAAECBAgQIEAgnYCgkm4kGiJAgAABAgQIECBAQFCxBwgQIECAAAECBAgQSCcgqKQbiYYIECBAgAABAgQIEBBU7AECBAgQIECAAAECBNIJCCrpRqIhAgQIECBAgAABAgQEFXuAAAECBAgQIECAAIF0AoJKupFoiAABAgQIECBAgAABQcUeIECAAAECBAgQIEAgnYCgkm4kGiJAgAABAgQIECBAQFCxBwgQIECAAAECBAgQSCcgqKQbiYYIECBAgAABAgQIEBBU7AECBAgQIECAAAECBNIJCCrpRqIhAgQIECBAgAABAgQEFXuAAAECBAgQIECAAIF0AoJKupFoiAABAgQIECBAgAABQcUeIECAAAECBAgQIEAgnYCgkm4kGiJAgAABAgQIECBAQFCxBwgQIECAAAECBAgQSCcgqKQbiYYIECBAgAABAgQIEBBU7AECBAgQIECAAAECBNIJCCrpRqIhAgQIECBAgAABAgQEFXuAAAECBAgQIECAAIF0AoJKupFoiAABAgQIECBAgAABQcUeIECAAAECBAgQIEAgnYCgkm4kGiJAgAABAgQIECBAQFCxBwgQIECAAAECBAgQSCcgqKQbiYYIECBAgAABAgQIEBBU7AECBAgQIECAAAECBNIJCCrpRqIhAgQIECBAgAABAgQEFXuAAAECBAgQIECAAIF0AoJKupFoiAABAgQIECBAgAABQcUeIECAAAECBAgQIEAgnYCgkm4kGiJAgAABAgQIECBAQFCxBwgQIECAAAECBAgQSCcgqKQbiYYIECBAgAABAgQIEBBU7AECBAgQIECAAAECBNIJCCrpRqIhAgQIECBAgAABAgQEFXuAAAECBAgQIECAAIF0AoJKupFoiAABAgQIECBAgAABQcUeIECAAAECBAgQIEAgnYCgkm4kGiJAgAABAgQIECBAQFCxBwgQIECAAAECBAgQSCcgqKQbiYYIECBAgAABAgQIEBBU7AECBAgQIECAAAECBNIJCCrpRqIhAgQIECBAgAABAgQEFXuAAAECBAgQIECAAIF0AoJKupFoiAABAgQIECBAgAABQcUeIECAAAECBAgQIEAgnYCgkm4kGiJAgAABAgQIECBAQFCxBwgQIECAAAECBAgQSCcgqKQbiYYIECBAgAABAgQIEBBU7AECBAgQIECAAAECBNIJCCrpRqIhAgQIECBAgAABAgQEFXuAAAECBAgQIECAAIF0AoJKupFoiAABAgQIECBAgAABQcUeIECAAAECBAgQIEAgnYCgkm4kGiJAgAABAgQIECBAQFCxBwgQIECAAAECBAgQSCcgqKQbiYYIECBAgAABAgQIEBBU7AECBAgQIECAAAECBNIJCCrpRqIhAgQIECBAgAABAgQEFXuAAAECBAgQIECAAIF0AoJKupFoiAABAgQIECBAgAABQcUeIECAAAECBAgQIEAgnYCgkm4kGiJAgAABAgQIECBAQFCxBwgQIECAAAECBAgQSCcgqKQbiYYIECBAgAABAgQIEBBU7AECBAgQIECAAAECBNIJCCrpRqIhAgQIECBAgAABAgQEFXuAAAECBAgQIECAAIF0AoJKupFoiAABAgQIECBAgAABQcUeIECAAAECBAgQIEAgnYCgkm4kGiJAgAABAgQIECBAQFCxBwgQIECAAAECBAgQSCcgqKQbiYYIECBAgAABAgQIEBBU7AECBAgQIECAAAECBNIJCCrpRqIhAgQIECBAgAABAgQEFXuAAAECBAgQIECAAIF0AoJKupFoiAABAgQIECBAgAABQcUeIECAAAECBAgQIEAgnYCgkm4kGiJAgAABAgQIECBAQFCxBwgQIECAAAECBAgQSCcgqKQbiYYIECBAgAABAgQIEBBU7AECBAgQIECAAAECBNIJCCrpRqIhAgQIECBAgAABAgQEFXuAAAECBAgQIECAAIF0AoJKupFoiAABAgQIECBAgAABQcUeIECAAAECBAgQIEAgnYCgkm4kGiJAgAABAgQIECBAQFCxBwgQIECAAAECBAgQSCcgqKQbiYYIECBAgAABAgQIEBBU7AECBAgQIECAAAECBNIJCCrpRqIhAgQIECBAgAABAgQEFXuAAAECBAgQIECAAIF0AoJKupFoiAABAgQIECBAgAABQcUeIECAAAECBAgQIEAgnYCgkm4kGiJAgAABAgQIECBAQFCxBwgQIECAAAECBAgQSCcgqKQbiYYIECBAgAABAgQIEBBU7AECBAgQIECAAAECBNIJCCrpRqIhAgQIECBAgAABAgQEFXuAAAECBAgQIECAAIF0AoJKupFoiAABAgQIECBAgAABQcUeIECAAAECBAgQIEAgnYCgkm4kGiJAgAABAgQIECBAQFCxBwgQIECAAAECBAgQSCcgqKQbiYYIECBAgAABAgQIEBBU7AECBAgQIECAAAECBNIJCCrpRqIhAgQIECBAgAABAgQEFXuAAAECBAgQIECAAIF0AoJKupFoiAABAgQIECBAgAABQcUeIECAAAECBAgQIEAgnYCgkm4kGiJAgAABAgQIECBAQFCxBwgQIECAAAECBAgQSCcgqKQbiYYIECBAgAABAgQIEBBU7AECBAgQIECAAAECBNIJCCrpRqIhAgQIECBAgAABAgQEFXuAAAECBAgQIECAAIF0AoJKupFoiAABAgQIECBAgAABQcUeIECAAAECBAgQIEAgnYCgkm4kGiJAgAABAgQIECBAQFCxBwgQIECAAAECBAgQSCcgqKQbiYYIECBAgAABAgQIEBBU7AECBAgQIECAAAECBNIJCCrpRqIhAgQIECBAgAABAgQEFXuAAAECBAgQIECAAIF0AoJKupFoiAABAgQIECBAgAABQcUeIECAAAECBAgQIEAgnYCgkm4kGiJAgAABAgQIECBAQFCxBwgQIECAAAECBAgQSCcgqKQbiYYIECBAgAABAgQIEBBU7AECBAgQIECAAAECBNIJCCrpRqIhAgQIECBAgAABAgQEFXuAAAECBAgQIECAAIF0AoJKupFoiAABAgQIECBAgAABQcUeIECAAAECBAgQIEAgnYCgkm4kGiJAgAABAgQIECBAQFCxBwgQIECAAAECBAgQSCcgqKQbiYYIECBAgAABAgQIEBBU7AECBAgQIECAAAECBNIJCCrpRqIhAgQIECBAgAABAgQEFXuAAAECBAgQIECAAIF0AoJKupFoiAABAgQIECBAgAABQcUeIECAAAECBAgQIEAgnYCgkm4kGiJAgAABAgQIECBAQFCxBwgQIECAAAECBAgQSCcgqKQbiYYIECBAgAABAgQIEBBU7AECBAgQIECAAAECBNIJCCrpRqIhAgQIECBAgAABAgQEFXuAAAECBAgQIECAAIF0AoJKupFoiAABAgQIECBAgAABQcUeIECAAAECBAgQIEAgnYCgkm4kGiJAgAABAgQIECBAQFCxBwgQIECAAAECBAgQSCcgqKQbiYYIECBAgAABAgQIEBBU7AECBAgQIECAAAECBNIJCCrpRqIhAgQIECBAgAABAgQEFXuAAAECBAgQIECAAIF0AoJKupFoiAABAgQIECBAgAABQcUeIECAAAECBAgQIEAgnYCgkm4kGiJAgAABAgQIECBAQFCxBwgQIECAAAECBAgQSCcgqKQbiYYIECBAgAABAgQIEBBU7AECBAgQIECAAAECBNIJCCrpRqIhAgQIECBAgAABAgQEFXuAAAECBAgQIECAAIF0AoJKupFoiAABAgQIECBAgAABQcUeIECAAAECBAgQIEAgnYCgkm4kGiJAgAABAgQIECBAQFCxBwgQIECAAAECBAgQSCcgqKQbiYYIECBAgAABAgQIEBBU7AECBAgQIECAAAECBNIJCCrpRqIhAgQIECBAgAABAgQEFXuAAAECBAgQIECAAIF0AoJKupFoiAABAgQIECBAgAABQcUeIECAAAECBAgQIEAgnYCgkm4kGiJAgAABAgQIECBAQFCxBwgQIECAAAECBAgQSCcgqKQbiYYIECBAgAABAgQIEBBU7AECBAgQIECAAAECBNIJCCrpRqIhAgQIECBAgAABAgQEFXuAAAECBAgQIECAAIF0AoJKupFoiAABAgQIECBAgAABQcUeIECAAAECBAgQIEAgnYCgkm4kGiJAgAABAgQIECBAQFCxBwgQIECAAAECBAgQSCcgqKQbiYYIECBAgAABAgQIEBBU7AECBAgQIECA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kSOCSbi2CxAgMEUBQWWKU3fPBAgQmIBAfepSA0v99+TJk71/P//8894RyPW/z58/f+lxyPXJyP79+/eEDh06VN54441y8ODBvf/WJyb1aUn9QrwXAQIECMQKCCqxvqoTIECAAAECBAgQINAgIKg0oFlCgAABAgQIECBAgECsgKAS66s6AQIECBAgQIAAAQINAoJKA5olBAgQIECAAAECBAjECggqsb6qEyBAgAABAgQIECDQICCoNKBZQoAAAQIECBAgQIBArICgEuurOgECBAgQIECAAAECDQKCSgOaJQQIECBAgAABAgQIxAoIKrG+qhMgQIAAAQIECBAg0CAgqDSgWUKAAAECBAgQIECAQKyAoBLrqzoBAgQIECBAgAABAg0CgkoDmiUECBAgQIAAAQIECMQKCCqxvqoTIECAAAECBAgQINAgIKg0oFlCgAABAgQIECBAgECsgKAS66s6AQIECBAgQIAAAQINAoJKA5olBAgQIECAAAECBAjECggqsb6qEyBAgAABAgQIECDQICCoNKBZQoAAAQIECBAgQIBArICgEuurOgECBAgQIECAAAECDQKCSgOaJQQIECBAgAABAgQIxAoIKrG+qhMgQIAAAQIECBAg0CAgqDSgWUKAAAECBAgQIECAQKyAoBLrqzoBAgQIECBAgAABAg0CgkoDmiUECBAgQIAAAQIECMQKCCqxvqoTIECAAAECBAgQINAgIKg0oFlCgAABAgQIECBAgECsgKAS66s6AQIECBAgQIAAAQINAoJKA5olBAgQIECAAAECBAjECggqsb6qEyBAgAABAgQIECDQICCoNKBZQoAAAQIECBAgQIBArICgEuurOgECBAgQIECAAAECDQKCSgOaJQQIECBAgAABAgQIxAoIKrG+qhMgQIAAAQIECBAg0CAgqDSgWUKAAAECBAgQIECAQKyAoBLrqzoBAgQIECBAgAABAg0CgkoDmiUECBAgQIAAAQIECMQKCCqxvqoTIECAAAECBAgQINAgIKg0oFlCgAABAgQIECBAgECsgKAS66s6AQIECBAgQIAAAQINAoJKA5olBAgQIECAAAECBAjECggqsb6qEyBAgAABAgQIECDQICCoNKBZQoAAAQIECBAgQIBArICgEuurOgECBAgQIECAAAECDQKCSgOaJQQIECBAgAABAgQIxAoIKrG+qhMgQIAAAQIECBAg0CAgqDSgWUKAAAECBAgQIECAQKyAoBLrqzoBAgQIECBAgAABAg0CgkoDmiUECBAgQIAAAQIECMQKCCqxvqoTIECAAAECBAgQINAgIKg0oFlCgAABAgQIECBAgECsgKAS66s6AQIECBAgQIAAAQINAoJKA5olBAgQIECAAAECBAjECggqsb6qEyBAgAABAgQIECDQICCoNKBZQoAAAQIECBAgQIBArICgEuurOgECBAgQIECAAAECDQKCSgOaJQQIECBAgAABAgQIxAoIKrG+qhMgQIAAAQIECBAg0CAgqDSgWUKAAAECBAgQIECAQKyAoBLrqzoBAgQIECBAgAABAg0CgkoDmiUECBAgQIAAAQIECMQKCCqxvqoTIECAAAECBAgQINAgIKg0oFlCgAABAgQIECBAgECsgKAS66s6AQIECBAgQIAAAQINAoJKA5olBAgQIECAAAECBAjECggqsb6qEyBAgAABAgQIECDQICCoNKBZQoAAAQIECBAgQIBArICgEuurOgECBAgQIECAAAECDQKCSgOaJQQIECBAgAABAgQIxAoIKrG+qhMgQIAAAQIECBAg0CAgqDSgWUKAAAECBAgQIECAQKyAoBLrqzoBAgQIECBAgAABAg0CgkoDmiUECBAgQIAAAQIECMQKCCqxvqoTIECAAAECBAgQINAgIKg0oFlCgAABAgQIECBAgECsgKAS66s6AQIECBAgQIAAAQINAoJKA5olBAgQIECAAAECBAjECggqsb6qEyBAgAABAgQIECDQICCoNKBZQoAAAQIECBAgQIBArICgEuurOgECBAgQIECAAAECDQKCSgOaJQQIECBAgAABAgQIxAoIKrG+qhMgQIAAAQIECBAg0CAgqDSgWUKAAAECBAgQIECAQKyAoBLrqzoBAgQIECBAgAABAg0CgkoDmiUECBAgQIAAAQIECMQKCCqxvqoTIECAAAECBAgQINAgIKg0oFlCgAABAgQIECBAgECsgKAS66s6AQIECBAgQIAAAQINAoJKA5olBAgQIECAAAECBAjECggqsb6qEyBAgAABAgQIECDQICCoNKBZQoAAAQIECBAgQIBArICgEuurOgECBAgQIECAAAECDQKCSgOaJQQIECBAgAABAgQIxAoIKrG+qhMgQIAAAQIECBAg0CAgqDSgWUKAAAECBAgQIECAQKyAoBLrqzoBAgQIECBAgAABAg0CgkoDmiUECBAgQIAAAQIECMQKCCqxvqoTIECAAAECBAgQINAgIKg0oFlCgAABAgQIECBAgECsgKAS66s6AQIECBAgQIAAAQINAoJKA5olBAgQIECAAAECBAjECggqsb6qEyBAgAABAgQIECDQICCoNKBZQoAAAQIECBAgQIBArICgEuurOgECBAgQIECAAAECDQKCSgOaJQQIECBAgAABAgQIxAoIKrG+qhMgQIAAAQIECBAg0CAgqDSgWUKAAAECBAgQIECAQKyAoBLrqzoBAgQIECBAgAABAg0CgkoDmiUECBAgQIAAAQIECMQKCCqxvqoTIECAAAECBAgQINAgIKg0oFlCgAABAgQIECBAgECsgKAS66s6AQIECBAgQIAAAQINAoJKA5olBAgQIECAAAECBAjECggqsb6qEyBAgAABAgQIECDQICCoNKBZQoAAAQIECBAgQIBArICgEuurOgECBAgQIECAAAECDQKCSgOaJQQIECBAgAABAgQIxAoIKrG+qhMgQIAAAQIECBAg0CAgqDSgWUKAAAECBAgQIECAQKyAoBLrqzoBAgQIECBAgAABAg0CgkoDmiUECBAgQIAAAQIECMQKCCqxvqoTIECAAAECBAgQINAgIKg0oFlCgAABAgQIECBAgECsgKAS66s6AQIECBAgQIAAAQINAoJKA5olBAgQIECAAAECBAjECggqsb6qEyBAgAABAgQIECDQICCoNKBZQoAAAQIECBAgQIBArICgEuurOgECBAgQIECAAAECDQKCSgOaJQQIECBAgAABAgQIxAoIKrG+qhMgQIAAAQIECBAg0CAgqDSgWUKAAAECBAgQIECAQKyAoBLrqzoBAgQIECBAgAABAg0CgkoDmiUECBAgQIAAAQIECMQKCCqxvqoTIECAAAECBAgQINAgIKg0oFlCgAABAgQIECBAgECsgKAS66s6AQIECBAgQIAAAQINAoJKA5olBAgQIECAAAECBAjECggqsb6qEyBAgAABAgQIECDQICCoNKBZQoAAAQIECBAgQIBArICgEuurOgECBAgQIECAAAECDQKCSgOaJQQIECBAgAABAgQIxAoIKrG+qhMgQIAAAQIECBAg0CAgqDSgWUKAAAECBAgQIECAQKyAoBLrqzoBAgQIECBAgAABAg0CgkoDmiUECBAgQIAAAQIECMQKCCqxvqoTIECAAAECBAgQINAgIKg0oFlCgAABAgQIECBAgECsgKAS66s6AQIECBAgQIAAAQINAoJKA5olBAgQIECAAAECBAjECggqsb6qEyBAgAABAgQIECDQICCoNKBZQoAAAQIECBAgQIBArICgEuurOgECBAgQIECAAAECDQKCSgOaJQQIECBAgAABAgQIxAoIKrG+qhMgQIAAAQIECBAg0CAgqDSgWUKAAAECBAgQIECAQKyAoBLrqzoBAgQIECBAgAABAg0CgkoDmiUECBAgQIAAAQIECMQKCCqxvqoTIECAAAECBOrEM+QAAAo9SURBVAgQINAgIKg0oFlCgAABAgQIECBAgECsgKAS66s6AQIECBAgQIAAAQINAoJKA5olBAgQIECAAAECBAjECggqsb6qEyBAgAABAgQIECDQICCoNKBZQoAAAQIECBAgQIBArICgEuurOgECBAgQIECAAAECDQKCSgOaJQQIECBAgAABAgQIxAoIKrG+qhMgQIAAAQIECBAg0CAgqDSgWUKAAAECBAgQIECAQKyAoBLrqzoBAgQIECBAgAABAg0CgkoDmiUECBAgQIAAAQIECMQKCCqxvqoTIECAAAECBAgQINAgIKg0oFlCgAABAgQIECBAgECsgKAS66s6AQIECBAgQIAAAQINAoJKA5olBAgQIECAAAECBAjECggqsb6qEyBAgAABAgQIECDQICCoNKBZQoAAAQIECBAgQIBArICgEuurOgECBAgQIECAAAECDQKCSgOaJQQIECBAgAABAgQIxAoIKrG+qhMgQIAAAQIECBAg0CAgqDSgWUKAAAECBAgQIECAQKyAoBLrqzoBAgQIECBAgAABAg0CgkoDmiUECBAgQIAAAQIECMQKCCqxvqoTIECAAAECBAgQINAgIKg0oFlCgAABAgQIECBAgECsgKAS66s6AQIECBAgQIAAAQINAoJKA5olBAgQIECAAAECBAjECggqsb6qEyBAgAABAgQIECDQICCoNKBZQoAAAQIECBAgQIBArICgEuurOgECBAgQIECAAAECDQKCSgOaJQQIECBAgAABAgQIxAoIKrG+qhMgQIAAAQIECBAg0CAgqDSgWUKAAAECBAgQIECAQKyAoBLrqzoBAgQIECBAgAABAg0CgkoDmiUECBAgQIAAAQIECMQKCCqxvqoTIECAAAECBAgQINAgIKg0oFlCgAABAgQIECBAgECsgKAS66s6AQIECBAgQIAAAQINAoJKA5olBAgQIECAAAECBAjECggqsb6qEyBAgAABAgQIECDQICCoNKBZQoAAAQIECBAgQIBArICgEuurOgECBAgQIECAAAECDQKCSgOaJQQIECBAgAABAgQIxAoIKrG+qhMgQIAAAQIECBAg0CAgqDSgWUKAAAECBAgQIECAQKyAoBLrqzoBAgQIECBAgAABAg0CgkoDmiUECBAgQIAAAQIECMQKCCqxvqoTIECAAAECBAgQINAgIKg0oFlCgAABAgQIECBAgECsgKAS66s6AQIECBAgQIAAAQINAoJKA5olBAgQIECAAAECBAjECggqsb6qEyBAgAABAgQIECDQICCoNKBZQoAAAQIECBAgQIBArICgEuurOgECBAgQIECAAAECDQKCSgOaJQQIECBAgAABAgQIxAoIKrG+qhMgQIAAAQIECBAg0CAgqDSgWUKAAAECBAgQIECAQKyAoBLrqzoBAgQIECBAgAABAg0CgkoDmiUECBAgQIAAAQIECMQKCCqxvqoTIECAAAECBAgQINAgIKg0oFlCgAABAgQIECBAgECsgKAS66s6AQIECBAgQIAAAQINAoJKA5olBAgQIECAAAECBAjECggqsb6qEyBAgAABAgQIECDQICCoNKBZQoAAAQIECBAgQIBArICgEuurOgECBAgQIECAAAECDQKCSgOaJQQIECBAgAABAgQIxAoIKrG+qhMgQIAAAQIECBAg0CAgqDSgWUKAAAECBAgQIECAQKyAoBLrqzoBAgQIECBAgAABAg0CgkoDmiUECBAgQIAAAQIECMQKCCqxvqoTIECAAAECBAgQINAgIKg0oFlCgAABAgQIECBAgECsgKAS66s6AQIECBAgQIAAAQINAoJKA5olBAgQIECAAAECBAjECggqsb6qEyBAgAABAgQIECDQICCoNKBZQoAAAQIECBAgQIBArICgEuurOgECBAgQIECAAAECDQKCSgOaJQQIECBAgAABAgQIxAoIKrG+qhMgQIAAAQIECBAg0CAgqDSgWUKAAAECBAgQIECAQKyAoBLrqzoBAgQIECBAgAABAg0CgkoDmiUECBAgQIAAAQIECMQKCCqxvqoTIECAAAECBAgQINAgIKg0oFlCgAABAgQIECBAgECsgKAS66s6AQIECBAgQIAAAQINAoJKA5olBAgQIECAAAECBAjECggqsb6qEyBAgAABAgQIECDQICCoNKBZQoAAAQIECBAgQIBArICgEuurOgECBAgQIECAAAECDQKCSgOaJQQIECBAgAABAgQIxAoIKrG+qhMgQIAAAQIECBAg0CAgqDSgWUKAAAECBAgQIECAQKyAoBLrqzoBAgQIECBAgAABAg0CgkoDmiUECBAgQIAAAQIECMQKCCqxvqoTIECAAAECBAgQINAgIKg0oFlCgAABAgQIECBAgECsgKAS66s6AQIECBAgQIAAAQINAoJKA5olBAgQIECAAAECBAjECggqsb6qEyBAgAABAgQIECDQICCoNKBZQoAAAQIECBAgQIBArICgEuurOgECBAgQIECAAAECDQKCSgOaJQQIECBAgAABAgQIxAoIKrG+qhMgQIAAAQIECBAg0CAgqDSgWUKAAAECBAgQIECAQKyAoBLrqzoBAgQIECBAgAABAg0CgkoDmiUECBAgQIAAAQIECMQKCCqxvqoTIECAAAECBAgQINAgIKg0oFlCgAABAgQIECBAgECsgKAS66s6AQIECBAgQIAAAQINAoJKA5olBAgQIECAAAECBAjECggqsb6qEyBAgAABAgQIECDQICCoNKBZQoAAAQIECBAgQIBArICgEuurOgECBAgQIECAAAECDQKCSgOaJQQIECBAgAABAgQIxAoIKrG+qhMgQIAAAQIECBAg0CAgqDSgWUKAAAECBAgQIECAQKyAoBLrqzoBAgQIECBAgAABAg0CgkoDmiUECBAgQIAAAQIECMQKCCqxvqoTIECAAAECBAgQINAgIKg0oFlCgAABAgQIECBAgECsgKAS66s6AQIECBAgQIAAAQINAoJKA5olBAgQIECAAAECBAjECggqsb6qEyBAgAABAgQIECDQICCoNKBZQoAAAQIECBAgQIBArICgEuurOgECBAgQIECAAAECDQKCSgOaJQQIECBAgAABAgQIxAoIKrG+qhMgQIAAAQIECBAg0CAgqDSgWUKAAAECBAgQIECAQKyAoBLrqzoBAgQIECBAgAABAg0CgkoDmiUECBAgQIAAAQIECMQKCCqxvqoTIECAAAECBAgQINAgIKg0oFlCgAABAgQIECBAgECsgKAS66s6AQIECBAgQIAAAQINAoJKA5olBAgQIECAAAECBAjECggqsb6qEyBAgAABAgQIECDQICCoNKBZQoAAAQIECBAgQIBArICgEuurOgECBAgQIECAAAECDQKCSgOaJQQIECBAgAABAgQIxAoIKrG+qhMgQIAAAQIECBAg0CAgqDSgWUKAAAECBAgQIECAQKyAoBLrqzoBAgQIECBAgAABAg0CgkoDmiUECBAgQIAAAQIECMQK/B9d9hNVBnYnzwAAAABJRU5ErkJggg==');
    background-size: cover;
    background-position: center;
  }

  ${({ theme }) => theme.media.xl} {
    height: calc(15vw - 20px);
  }

  ${({ theme }) => theme.media.lg} {
    height: calc(20vw - 20px);
  }

  ${({ theme }) => theme.media.md} {
    height: calc(50vw - 20px);
  }

  ${({ theme }) => theme.media.sm} {
    height: calc(100vw - 20px);
  }
`;
const WebsiteSVG = () => {
  return (
    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path
        d="M10 20C8.63333 20 7.34167 19.7373 6.125 19.212C4.90833 18.6873 3.846 17.9707 2.938 17.062C2.02933 16.154 1.31267 15.0917 0.788 13.875C0.262667 12.6583 0 11.3667 0 10C0 8.61667 0.262667 7.321 0.788 6.113C1.31267 4.90433 2.02933 3.846 2.938 2.938C3.846 2.02933 4.90833 1.31233 6.125 0.787C7.34167 0.262333 8.63333 0 10 0C11.3833 0 12.679 0.262333 13.887 0.787C15.0957 1.31233 16.154 2.02933 17.062 2.938C17.9707 3.846 18.6873 4.90433 19.212 6.113C19.7373 7.321 20 8.61667 20 10C20 11.3667 19.7373 12.6583 19.212 13.875C18.6873 15.0917 17.9707 16.154 17.062 17.062C16.154 17.9707 15.0957 18.6873 13.887 19.212C12.679 19.7373 11.3833 20 10 20ZM10 17.95C10.4333 17.35 10.8083 16.725 11.125 16.075C11.4417 15.425 11.7 14.7333 11.9 14H8.1C8.3 14.7333 8.55833 15.425 8.875 16.075C9.19167 16.725 9.56667 17.35 10 17.95ZM7.4 17.55C7.1 17 6.83767 16.429 6.613 15.837C6.38767 15.2457 6.2 14.6333 6.05 14H3.1C3.58333 14.8333 4.18733 15.5583 4.912 16.175C5.63733 16.7917 6.46667 17.25 7.4 17.55ZM12.6 17.55C13.5333 17.25 14.3623 16.7917 15.087 16.175C15.8123 15.5583 16.4167 14.8333 16.9 14H13.95C13.8 14.6333 13.6127 15.2457 13.388 15.837C13.1627 16.429 12.9 17 12.6 17.55ZM2.25 12H5.65C5.6 11.6667 5.56233 11.3373 5.537 11.012C5.51233 10.6873 5.5 10.35 5.5 10C5.5 9.65 5.51233 9.31267 5.537 8.988C5.56233 8.66267 5.6 8.33333 5.65 8H2.25C2.16667 8.33333 2.104 8.66267 2.062 8.988C2.02067 9.31267 2 9.65 2 10C2 10.35 2.02067 10.6873 2.062 11.012C2.104 11.3373 2.16667 11.6667 2.25 12ZM7.65 12H12.35C12.4 11.6667 12.4377 11.3373 12.463 11.012C12.4877 10.6873 12.5 10.35 12.5 10C12.5 9.65 12.4877 9.31267 12.463 8.988C12.4377 8.66267 12.4 8.33333 12.35 8H7.65C7.6 8.33333 7.56267 8.66267 7.538 8.988C7.51267 9.31267 7.5 9.65 7.5 10C7.5 10.35 7.51267 10.6873 7.538 11.012C7.56267 11.3373 7.6 11.6667 7.65 12ZM14.35 12H17.75C17.8333 11.6667 17.896 11.3373 17.938 11.012C17.9793 10.6873 18 10.35 18 10C18 9.65 17.9793 9.31267 17.938 8.988C17.896 8.66267 17.8333 8.33333 17.75 8H14.35C14.4 8.33333 14.4373 8.66267 14.462 8.988C14.4873 9.31267 14.5 9.65 14.5 10C14.5 10.35 14.4873 10.6873 14.462 11.012C14.4373 11.3373 14.4 11.6667 14.35 12ZM13.95 6H16.9C16.4167 5.16667 15.8123 4.44167 15.087 3.825C14.3623 3.20833 13.5333 2.75 12.6 2.45C12.9 3 13.1627 3.57067 13.388 4.162C13.6127 4.754 13.8 5.36667 13.95 6ZM8.1 6H11.9C11.7 5.26667 11.4417 4.575 11.125 3.925C10.8083 3.275 10.4333 2.65 10 2.05C9.56667 2.65 9.19167 3.275 8.875 3.925C8.55833 4.575 8.3 5.26667 8.1 6ZM3.1 6H6.05C6.2 5.36667 6.38767 4.754 6.613 4.162C6.83767 3.57067 7.1 3 7.4 2.45C6.46667 2.75 5.63733 3.20833 4.912 3.825C4.18733 4.44167 3.58333 5.16667 3.1 6Z"
        fill="white"
      />
    </svg>
  );
};
const DiscordSVG = () => {
  return (
    <svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path
        d="M16.9308 1.66358C15.6561 1.07868 14.2892 0.647749 12.8599 0.400938C12.8339 0.396174 12.8079 0.408078 12.7945 0.431887C12.6187 0.744566 12.4239 1.15248 12.2876 1.4731C10.7503 1.24296 9.22099 1.24296 7.71527 1.4731C7.57887 1.14535 7.37707 0.744566 7.20048 0.431887C7.18707 0.408873 7.16107 0.396969 7.13504 0.400938C5.70659 0.64696 4.33963 1.07789 3.06411 1.66358C3.05307 1.66834 3.04361 1.67628 3.03732 1.68659C0.444493 5.56023 -0.265792 9.33865 0.0826501 13.0702C0.0842267 13.0885 0.0944749 13.1059 0.108665 13.117C1.81934 14.3733 3.47642 15.136 5.10273 15.6415C5.12876 15.6495 5.15634 15.6399 5.1729 15.6185C5.55761 15.0932 5.90054 14.5392 6.19456 13.9567C6.21192 13.9226 6.19535 13.8821 6.15989 13.8686C5.61594 13.6623 5.098 13.4107 4.59977 13.125C4.56037 13.102 4.55721 13.0456 4.59347 13.0186C4.69831 12.9401 4.80318 12.8583 4.9033 12.7758C4.92141 12.7607 4.94665 12.7575 4.96794 12.767C8.24107 14.2614 11.7846 14.2614 15.0191 12.767C15.0404 12.7567 15.0657 12.7599 15.0846 12.775C15.1847 12.8575 15.2895 12.9401 15.3952 13.0186C15.4314 13.0456 15.4291 13.102 15.3897 13.125C14.8914 13.4162 14.3735 13.6623 13.8288 13.8678C13.7933 13.8813 13.7775 13.9226 13.7949 13.9567C14.0952 14.5384 14.4381 15.0923 14.8157 15.6177C14.8315 15.6399 14.8599 15.6495 14.8859 15.6415C16.5201 15.136 18.1772 14.3733 19.8879 13.117C19.9028 13.1059 19.9123 13.0893 19.9139 13.071C20.3309 8.7569 19.2154 5.00947 16.9568 1.68738C16.9513 1.67628 16.9419 1.66834 16.9308 1.66358ZM6.68335 10.7981C5.69792 10.7981 4.88594 9.89338 4.88594 8.78231C4.88594 7.67124 5.68217 6.76654 6.68335 6.76654C7.69239 6.76654 8.49651 7.67919 8.48073 8.78231C8.48073 9.89338 7.68451 10.7981 6.68335 10.7981ZM13.329 10.7981C12.3435 10.7981 11.5316 9.89338 11.5316 8.78231C11.5316 7.67124 12.3278 6.76654 13.329 6.76654C14.338 6.76654 15.1421 7.67919 15.1264 8.78231C15.1264 9.89338 14.338 10.7981 13.329 10.7981Z"
        fill="white"
      />
    </svg>
  );
};
const TwitterSVG = () => {
  return (
    <svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path
        d="M6.2918 16C13.8371 16 17.9652 9.84369 17.9652 4.50658C17.9652 4.33351 17.9613 4.15659 17.9535 3.98352C18.7566 3.41173 19.4496 2.70348 20 1.89206C19.2521 2.21968 18.458 2.43365 17.6449 2.52665C18.5011 2.02137 19.1421 1.22761 19.4492 0.292501C18.6438 0.762466 17.763 1.09399 16.8445 1.27285C16.2257 0.625448 15.4075 0.196792 14.5164 0.0531537C13.6253 -0.0904844 12.711 0.0588966 11.9148 0.478201C11.1186 0.897505 10.4848 1.56338 10.1115 2.37287C9.73825 3.18236 9.64619 4.09039 9.84961 4.95656C8.21874 4.87598 6.62328 4.45886 5.16665 3.73224C3.71002 3.00561 2.42474 1.98571 1.39414 0.738639C0.870333 1.62782 0.710047 2.68001 0.945859 3.68136C1.18167 4.68271 1.79589 5.5581 2.66367 6.12959C2.01219 6.10923 1.37498 5.93653 0.804688 5.62577V5.67576C0.804104 6.60889 1.13175 7.51342 1.73192 8.2356C2.3321 8.95777 3.16777 9.45302 4.09687 9.63716C3.49338 9.79973 2.85999 9.82342 2.2457 9.70638C2.50788 10.5089 3.01798 11.2108 3.70481 11.7141C4.39164 12.2174 5.22093 12.497 6.07695 12.514C4.62369 13.6379 2.82848 14.2476 0.980469 14.2447C0.652739 14.2442 0.325333 14.2244 0 14.1855C1.87738 15.3713 4.06128 16.0011 6.2918 16Z"
        fill="white"
      />
    </svg>
  );
};
const MediumSVG = () => {
  return (
    <svg width="21" height="16" viewBox="0 0 21 16" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path
        d="M20.011 2.35847H20.8093V0H13.2509L10.7388 9.26312H10.6701L8.18129 0H0.599609V2.35847H1.37566C1.74288 2.41806 2.03627 2.69622 2.11534 3.05974V12.9928C2.03202 13.3445 1.73518 13.6048 1.37566 13.6415H0.599609V16H6.66251V13.6415H5.14679V3.2002H5.23571L8.72897 16H11.4694L15.0091 3.2002H15.0829V13.6415H13.5671V16H20.8093V13.6415H20.01C19.6596 13.5958 19.3742 13.3378 19.2935 12.9938V3.06075C19.3696 2.70363 19.6523 2.4269 20.011 2.35847Z"
        fill="white"
      />
    </svg>
  );
};
const DistriktSVG = () => {
  return (
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <g clipPath="url(#clip0_2183_6405)">
        <path d="M24 0H0V24H24V0Z" fill="white" fillOpacity="0.01" />
        <path d="M21.65 2.3999H18.041V6.00893H21.65V2.3999Z" fill="black" />
        <path
          fillRule="evenodd"
          clipRule="evenodd"
          d="M13.3896 6.49023H5.69043V10.0993H13.3896V17.7985H16.9987V10.0993V6.49023H13.3896Z"
          fill="white"
        />
        <path
          fillRule="evenodd"
          clipRule="evenodd"
          d="M5.20863 21.6002H12.9078V17.9912H5.20863V10.292H1.59961V17.9912V21.6002H5.20863Z"
          fill="white"
        />
      </g>
      <defs>
        <clipPath id="clip0_2183_6405">
          <rect width="24" height="24" fill="white" />
        </clipPath>
      </defs>
    </svg>
  );
};
const DscvrSVG = () => {
  return (
    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path
        fillRule="evenodd"
        clipRule="evenodd"
        d="M6.46791 12.1344C6.46791 12.1344 7.33327 12.9621 8.84839 13.2808C8.83135 13.2941 8.84839 6.6751 8.84839 6.6751C8.84839 6.6751 11.7217 5.92685 13.2452 8.18518C13.2658 8.19846 14.5813 10.1844 13.0534 12.3685C13.0476 12.3859 11.7969 14.148 9.36047 13.9445C9.33927 13.939 6.55567 14.139 4.77647 11.1621C4.76464 11.1517 2.94897 7.8335 5.02899 4.63653C5.01206 4.61887 6.63287 1.83045 10.4017 2.06863C10.4077 2.06429 15.3397 2.06373 17.4491 7.37958C17.4646 7.41046 18.9121 11.1324 16.5513 14.2102C16.5473 14.2368 14.4995 18.1569 9.20487 17.767C9.19911 17.7929 4.13438 17.972 1.86493 12.1344C1.86856 12.1345 0.772445 9.79998 1.86493 6.05182C1.8836 6.0131 1.79148 5.52941 1.51857 5.52941C1.50806 5.53636 0.833717 6.38558 0.516845 8.47302C0.501853 8.45206 -0.0834194 11.6879 1.51857 14.5219C1.51746 14.5285 3.47633 18.506 8.51975 19.5081C8.52495 19.4559 13.8471 20.6255 17.6163 15.8937C17.6118 15.8661 20.5137 12.8637 19.1995 7.14278C19.1573 7.12022 17.6008 1.08901 10.6289 0.424309C10.6242 0.433861 5.84901 -0.174826 3.34861 4.14909C3.33953 4.13614 1.16692 7.72198 3.17167 11.6869C3.16736 11.7014 5.47873 16.4919 10.6289 15.8937C10.6415 15.9051 15.6621 15.3633 16.1067 9.9999C16.0937 9.98278 15.8841 4.15297 10.2451 3.86253C10.1964 3.85355 8.50055 3.82614 6.32855 5.06093C6.30239 5.0789 6.46791 12.1344 6.46791 12.1344Z"
        fill="white"
      />
    </svg>
  );
};

const VaultPage = () => {
  const { loggedIn, principal, actor, activeWalletProvider, handleLogOut } =
    useContext(AuthContext);
  const [principalId, setPrincipalId] = useState<string>();
  const [canisterId, setCanisterId] = React.useState('');
  const [openManageDeposit, setOpenManageDeposit] = React.useState(false);
  const [inputText, setInputText] = useState('');
  const [isLoaded, setIsLoaded] = useState(false);
  const [openTrx, setOpenTrx] = useState(false);
  const [showManageEscrowsButton, setShowManageEscrowsButton] = useState(false);
  const { enqueueSnackbar } = useSnackbar() || {};
  const { activeTokens, time } = useTokensContext();
  const { open } = useDialog();
  const { state, dispatch } = useVault();
  const { ownedItems, collectionData, odcs, filter, sort, filteredOdcs } = state;

  const logout = async () => {
    handleLogOut();
    fetchData();
  };

  const handleClose = async (dataChanged = false) => {
    setEscrowsModalOpen(false);
    setOpenTrx(false);
    if (dataChanged) {
      fetchData();
    }
  };

  const fetchData = async () => {
    if (!actor) {
      return;
    }

    try {
      const { canisterId } = await useRoute();
      setCanisterId(canisterId);

      OrigynClient.getInstance().init(true, canisterId, { actor });

      // get the canister's collection metadata
      const collMetaResp = await getNftCollectionMeta([]);
      if (collMetaResp.err) {
        console.log(collMetaResp.err);
        throw new Error('Unable to retrieve collection metadata.');
      }

      const collMeta = collMetaResp.ok;
      const metadataClass = collMeta?.metadata?.[0]?.Class;
      const collectionData = parseMetadata(metadataClass);
      dispatch({ type: 'collectionData', payload: collectionData });

      if (principal) {
        const vaultBalanceInfo = await actor?.balance_of_nft_origyn({ principal });
        if (vaultBalanceInfo.err) {
          throw new Error(Object.keys(vaultBalanceInfo.err)[0]);
        }

        // get list of digital certificates owned by the current user
        const ownedTokenIds = vaultBalanceInfo?.ok?.nfts || [];
        const odcDataRaw = await actor?.nft_batch_origyn(ownedTokenIds);
        if (odcDataRaw.err) {
          console.log(odcDataRaw.err);
          throw new Error('Unable to retrieve metadata of tokens.');
        }

        // parse the digital certificate data (metadata and sale info)
        const parsedOdcs = parseOdcs(odcDataRaw);
        dispatch({ type: 'odcs', payload: parsedOdcs });
        dispatch({ type: 'filteredOdcs', payload: parsedOdcs });
        dispatch({ type: 'ownedItems', payload: ownedTokenIds.length || 0 });

        setShowManageEscrowsButton(
          vaultBalanceInfo?.ok?.escrow?.length > 0 || vaultBalanceInfo?.ok?.offers?.length > 0,
        );
      } else {
        dispatch({ type: 'odcs', payload: [] });
        dispatch({ type: 'filteredOdcs', payload: [] });
        dispatch({ type: 'ownedItems', payload: 0 });
        setShowManageEscrowsButton(false);
      }
    } catch (err) {
      console.error(err);
      enqueueSnackbar(err?.message || err, {
        variant: 'error',
        anchorOrigin: {
          vertical: 'top',
          horizontal: 'right',
        },
      });
    } finally {
      setIsLoaded(true);
    }
  };

  useEffect(() => {
    document.title = 'Origyn Vault';
    useRoute().then(({ canisterId }) => {
      setCanisterId(canisterId);
    });
  }, []);

  useEffect(() => {
    setPrincipalId(
      !principal || principal.toText() === Principal.anonymous().toText() ? '' : principal.toText(),
    );
  }, [principal]);

  /* Fetch data from canister when the actor reference
   * is ready, then every 5 seconds */
  useEffect(() => {
    let intervalId: any;
    if (actor) {
      fetchData();
      if (!intervalId) {
        intervalId = setInterval(() => {
          fetchData();
        }, 5000);
      }
    }
    return () => {
      if (intervalId) {
        clearInterval(intervalId);
      }
    };
  }, [actor]);

  useEffect(() => {
    if (actor && loggedIn && principal) {
      fetchData();
    }
  }, [loggedIn, actor, principal]);

  const [escrowsModalOpen, setEscrowsModalOpen] = useState(false);

  /** Apply filter and sort to list */
  useEffect(() => {
    let filtered = odcs;

    switch (filter) {
      case 'onSale':
        filtered = filtered.filter((odc) => odc.auctionOpen);
        break;
      case 'notOnSale':
        filtered = filtered.filter((odc) => !odc.auctionOpen);
        break;
    }

    switch (sort) {
      case 'saleASC':
        filtered = [...filtered].sort((odc1, odc2) => {
          return Math.max(odc2.buyNow, odc2.currentBid) - Math.max(odc1.buyNow, odc1.currentBid);
        });
        break;
      case 'saleDESC':
        filtered = [...filtered].sort((odc1, odc2) => {
          return Math.max(odc1.buyNow, odc1.currentBid) - Math.max(odc2.buyNow, odc2.currentBid);
        });
        break;
    }

    if (inputText?.length) {
      filtered = filtered.filter((odc) => odc?.displayName?.toLowerCase().includes(inputText));
    }

    dispatch({ type: 'filteredOdcs', payload: filtered });
  }, [filter, sort, inputText, odcs]);

  useEffect(() => {
    if (loggedIn) {
      fetchData();
    }
  }, [loggedIn]);

  return (
    <>
      {loggedIn ? (
        <Flex fullWidth padding="0" flexFlow="column">
          <SecondaryNav
            title="Vault"
            tabs={[{ title: 'Balance', id: 'Balance' }]}
            content={[
              <Flex fullWidth flexFlow="column" key="secondaryNavContent">
                <StyledSectionTitle>Vault Dashboard</StyledSectionTitle>
                <HR />
                {!isLoaded ? (
                  <LoadingContainer />
                ) : (
                  <StyledCustomGrid columns={2} gap={20}>
                    <div>
                      <Card
                        bgColor="NAVIGATION_BACKGROUND"
                        type="outlined"
                        flexFlow="column"
                        padding="24px"
                        gap={16}
                      >
                        <h6>Wallet Balances</h6>
                        <HR />
                        {Object.values(activeTokens)?.map((k, i) => (
                          <StyledBlackItemCard
                            key={i}
                            align="center"
                            padding="12px"
                            justify="space-between"
                          >
                            <Flex gap={8}>
                              <TokenIcon symbol={k.icon} />
                              {k.symbol}
                            </Flex>
                            <Flex flexFlow="column" align="flex-end">
                              <p>
                                <b>
                                  {k.balance} {k.symbol}
                                </b>
                              </p>
                            </Flex>
                          </StyledBlackItemCard>
                        ))}
                        <p className="small_text secondary_color">Last Updated: {time}</p>
                        <h6>Token Actions</h6>
                        <Button btnType="filled" onClick={() => setOpenTrx(true)}>
                          Transfer Tokens
                        </Button>
                        <WalletTokens>Manage Tokens</WalletTokens>

                        <h6>Active Transactions</h6>
                        {showManageEscrowsButton ? (
                          <Button btnType="filled" onClick={() => setEscrowsModalOpen(true)}>
                            Manage Escrows
                          </Button>
                        ) : (
                          <Button disabled>No assets in Escrow</Button>
                        )}
                        <Button btnType="filled" onClick={() => setOpenManageDeposit(true)}>
                          Manage Deposits
                        </Button>
                        {activeWalletProvider && (
                          <StyledBlackCard align="center" padding="12px" justify="space-between">
                            <Flex align="center" gap={12}>
                              <Icons.Wallet width={24} fill="#ffffff" height="100%" />
                              <Flex flexFlow="column">
                                <p style={{ fontSize: 12, color: '#9A9A9A' }}>
                                  {activeWalletProvider.meta.name.charAt(0).toUpperCase() +
                                    activeWalletProvider.meta.name.slice(1)}
                                </p>
                                <p>
                                  {principal.toText().slice(0, 2)}...{principal.toText().slice(-4)}
                                </p>
                              </Flex>
                            </Flex>
                            <Flex flexFlow="column" align="flex-end">
                              <Button
                                iconButton
                                size="medium"
                                onClick={() =>
                                  copyToClipboard(principal.toText(), () => {
                                    enqueueSnackbar('Copied to clipboard', {
                                      variant: 'success',
                                      anchorOrigin: {
                                        vertical: 'top',
                                        horizontal: 'right',
                                      },
                                    });
                                  })
                                }
                              >
                                <Icons.CopyIcon width={12} height="100%" />
                              </Button>
                            </Flex>
                          </StyledBlackCard>
                        )}
                      </Card>
                    </div>
                    {collectionData && (
                      <div>
                        <Flex align="flex-start" gap={24}>
                          {collectionData.hasPreviewAsset ? (
                            <StyledCollectionImg
                              src={`https://prptl.io/-/${canisterId}/collection/preview`}
                              alt=""
                            />
                          ) : (
                            <StyledCollectionImg
                              src={PlaceholderImage}
                              alt="text"
                              style={{ width: 200 }}
                            />
                          )}
                          <Flex flexFlow="column" fullWidth justify="space-between" gap={8}>
                            <Flex
                              flexFlow="row"
                              align="center"
                              fullWidth
                              justify="space-between"
                              smFlexFlow="column"
                            >
                              <h2>{collectionData.displayName}</h2>

                              <Flex
                                style={{
                                  flexWrap: 'wrap',
                                  marginTop: '8px',
                                  alignContent: 'flex-end',
                                }}
                                gap={8}
                              >
                                {collectionData.socialLinks?.map((link, index) => (
                                  <SocialMediaButton
                                    as="a"
                                    iconButton
                                    target="_blank"
                                    href={link.url}
                                    key={index}
                                  >
                                    {
                                      {
                                        twitter: <TwitterSVG />,
                                        discord: <DiscordSVG />,
                                        medium: <MediumSVG />,
                                        dscvr: <DscvrSVG />,
                                        distrikt: <DistriktSVG />,
                                        website: <WebsiteSVG />,
                                      }[link.type]
                                    }
                                  </SocialMediaButton>
                                ))}
                                <SocialMediaButton
                                  as="a"
                                  iconButton
                                  target="_blank"
                                  href={`https://prptl.io/-/${canisterId}/collection/-/ledger`}
                                >
                                  Ledger
                                </SocialMediaButton>
                              </Flex>
                            </Flex>

                            <p>
                              <span className="secondary_color">Created by </span>
                              <span className="secondary_color">
                                {collectionData.originatorPrincipalId || 'no creator name'}
                              </span>
                            </p>
                            <br />
                            <Flex>
                              <Flex flexFlow="column">
                                <h5>{ownedItems}</h5>
                                <p className="secondary_color">Owned Items</p>
                              </Flex>
                            </Flex>
                            <br />
                            <ShowMoreBlock btnText="Read More">
                              <p className="secondary_color">{collectionData.description}</p>
                            </ShowMoreBlock>
                            <br />
                            <br />
                          </Flex>
                        </Flex>
                        <HR />
                        <br />
                        <Filter
                          onChangeFilter={(filterValue: string) =>
                            dispatch({ type: 'filter', payload: filterValue })
                          }
                          onChangeSort={(sortValue: string) =>
                            dispatch({ type: 'sort', payload: sortValue })
                          }
                          onInput={setInputText}
                        />
                        <br />
                        <TransferTokensModal open={openTrx} handleClose={handleClose} />
                        <ManageEscrowsModal
                          open={escrowsModalOpen}
                          handleClose={handleClose}
                          collection={collectionData}
                        />
                        {parseOdcs?.length > 0 ? (
                          <>
                            <Grid
                              smColumns={1}
                              mdColumns={2}
                              lgColumns={3}
                              xlColumns={4}
                              columns={6}
                              gap={20}
                            >
                              {filteredOdcs.map((odc) => {
                                return (
                                  <Link to={`/${odc?.id}`} key={odc?.id}>
                                    <Card
                                      flexFlow="column"
                                      style={{ overflow: 'hidden', height: '100%' }}
                                    >
                                      {odc.hasPreviewAsset ? (
                                        <StyledNFTImg
                                          onError={(e) => {
                                            e.target.onerror = null; // prevents looping
                                            e.currentTarget.className += ' errorImage';
                                          }}
                                          src={`https://${canisterId}.raw.ic0.app/-/${odc?.id}/preview`}
                                          alt=""
                                        />
                                      ) : (
                                        <StyledNFTImg
                                          src={PlaceholderImage}
                                          alt=""
                                          onError={(e) => {
                                            e.target.onerror = null; // prevents looping
                                            e.currentTarget.className += ' errorImage';
                                          }}
                                        />
                                      )}
                                      <Container
                                        style={{ height: '100%' }}
                                        size="full"
                                        padding="16px"
                                      >
                                        <Flex
                                          style={{ height: '100%' }}
                                          justify="space-between"
                                          flexFlow="column"
                                          gap={32}
                                        >
                                          <div>
                                            <p style={{ fontSize: '12px', color: '#9A9A9A' }}>
                                              {collectionData?.displayName}
                                            </p>
                                            <p>
                                              <b>{odc.displayName || odc.id}</b>
                                            </p>
                                          </div>
                                          <div>
                                            <p style={{ fontSize: '12px', color: '#9A9A9A' }}>
                                              Status
                                            </p>
                                            <p>
                                              {odc.auctionOpen ? (
                                                odc.currentBid === 0 ? (
                                                  <>
                                                    {currencyToFixed(
                                                      odc.buyNow,
                                                      Number(odc.token.decimals),
                                                    )}{' '}
                                                    <TokenIcon symbol={odc.tokenSymbol} />
                                                  </>
                                                ) : (
                                                  <>
                                                    {currencyToFixed(
                                                      odc.currentBid,
                                                      Number(odc.token.decimals),
                                                    )}{' '}
                                                    <TokenIcon symbol={odc.tokenSymbol} />
                                                  </>
                                                )
                                              ) : (
                                                'No auction started'
                                              )}
                                            </p>
                                          </div>
                                        </Flex>
                                      </Container>
                                    </Card>
                                  </Link>
                                );
                              })}
                            </Grid>
                            <br />
                          </>
                        ) : (
                          'There are no digital certificates in your vault'
                        )}
                      </div>
                    )}
                  </StyledCustomGrid>
                )}
              </Flex>,
            ]}
            onLogOut={logout}
            onConnect={open}
            principal={principalId}
          />
          <ManageDepositsModal
            open={openManageDeposit}
            handleClose={() => setOpenManageDeposit(false)}
          />
        </Flex>
      ) : (
        <GuestContainer />
      )}
    </>
  );
};

export default VaultPage;
